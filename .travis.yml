language: c
os: linux
branches:
    only:
        - master
        - /^travis.*$/
install:
    - cmake --version
    - python --version
    - pip --version
    - pip install --user -r requirements.txt
script:
    - python setup.py install
    - python -m pytest -s
    - cd ${AA_CMAKE_DIR} && ctest -V -C Release
after_failure:
  - cat "${AA_CMAKE_DIR}/CMakeFiles/CMakeOutput.log"
matrix:
  include:
    - os: linux
      env:
        - AA_CMAKE_DIR="${TRAVIS_BUILD_DIR}/build/temp.linux-x86_64-3.6"
        - LUA=lua5.3
        - AA_LUA_SUPPORT=ON
        - PATH=${TRAVIS_BUILD_DIR}/install/lua:$PATH
      before_install:
        - pyenv global 3.6.7
        - source .travis/setenv_lua.sh
    - os: windows
      before_install:
        - choco install python --version 3.7.6
      env: 
        - AA_CMAKE_DIR="${TRAVIS_BUILD_DIR}/build/temp.win-amd64-3.7/Release"
        - AA_LUA_SUPPORT=OFF
        - PATH=/c/Python37:/c/Python37/Scripts:$PATH