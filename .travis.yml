language: c
os: linux
branches:
    only:
        - master
        - travis
python:
    - "3.7"
branches:
  only:
    - master
install:
  - cmake --version
after_failure:
  - cat home/travis/build/guidanoli/aa/build/CMakeFiles/CMakeOutput.log
script-anchors:
  - &script-Makefiles
    - mkdir "${TRAVIS_BUILD_DIR}/build"
    - cd "${TRAVIS_BUILD_DIR}/build"
    - cmake .. -G"${GENERATOR}"
    - cmake --build . --config Release
    - ctest -V -C Release
    - cmake --build . --config Debug
    - ctest -V -C Debug
    - cd ..
    - python3 setup.py
    - python3 -m pytest
  - &script-VS15
    - mkdir "${TRAVIS_BUILD_DIR}/build"
    - cd ${TRAVIS_BUILD_DIR}/build
    - cmake .. -G"${GENERATOR}"
    - cmake --build . --config Release
    - ctest -V -C Release
    - cmake .. -G"${GENERATOR}" -DAA_PYTHON_SUPPORT=OFF
    - cmake --build . --config Debug
    - ctest -V -C Debug
    - cd ..
    - python setup.py
    - python -m pytest
matrix:
  include:
    - os: linux
      env: GENERATOR="Unix Makefiles"
      script: *script-Makefiles
      before_install:
        - python --version
        - pip install --user -r requirements.txt
    - os: windows
      script: *script-VS15
      before_install:
        - choco install python --version 3.7.6
        - python --version
        - pip install --user -r requirements.txt
      env:
        - GENERATOR="Visual Studio 15 2017 Win64"
        - PATH=/c/Python37:/c/Python37/Scripts:$PATH